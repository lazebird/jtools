import{r as resolveComponent,o as openBlock,c as createBlock,w as withCtx,a as createVNode,p as pushScopeId,b as popScopeId,d as createBaseVNode,e as ref,f as createElementBlock,g as renderList,F as Fragment,h as withKeys,i as createTextVNode,n as nextTick,t as toDisplayString,j as createCommentVNode,k as computed,u as unref,l as isRef,m as createApp,A as Antd}from"./vendor.64da502d.js";const p=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function a(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=a(o);fetch(o.href,l)}};p();var action_vue_vue_type_style_index_0_scoped_true_lang="",_export_sfc=(t,e)=>{const a=t.__vccOpts||t;for(const[n,o]of e)a[n]=o;return a};const _withScopeId$1=t=>(pushScopeId("data-v-14d9a9d0"),t=t(),popScopeId(),t),_hoisted_1$2=_withScopeId$1(()=>createBaseVNode("a",{href:"https://github.com/lazebird/xliff-helper",target:"_blank"},"@lazebird/xliff-helper",-1)),_sfc_main$4={props:{action:{type:Object,required:!0}},setup(t){return(e,a)=>{const n=resolveComponent("a-form-item"),o=resolveComponent("a-input"),l=resolveComponent("a-form");return openBlock(),createBlock(l,{class:"actionbar",layout:"inline",model:t.action},{default:withCtx(()=>[createVNode(n,{label:"Home"},{default:withCtx(()=>[_hoisted_1$2]),_:1}),createVNode(n,{label:"PostFunc"},{default:withCtx(()=>[createVNode(o,{value:t.action.postFunc,"onUpdate:value":a[0]||(a[0]=r=>t.action.postFunc=r),"allow-clear":""},null,8,["value"])]),_:1}),createVNode(n,{label:"Filter"},{default:withCtx(()=>[createVNode(o,{value:t.action.searchVal,"onUpdate:value":a[1]||(a[1]=r=>t.action.searchVal=r),"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"])}}};var actionVue=_export_sfc(_sfc_main$4,[["__scopeId","data-v-14d9a9d0"]]),config_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$1=createTextVNode(" + New Tag "),_sfc_main$3={props:{conf:{type:Object,required:!0},ignPats:{type:Array,required:!0}},emits:["update:ignPats"],setup(t,{emit:e}){const a=t,n=ref({input:!1,val:""}),o=ref();function l(d){ignPats.value=ignPats.value.filter(c=>c!==d)}function r(){n.value.val&&a.ignPats.indexOf(n.value.val)===-1&&e("update:ignPats",[...a.ignPats,n.value.val]),n.value={input:!1,val:""}}function _(){n.value.input=!0,nextTick(()=>o.value.focus())}return(d,c)=>{const i=resolveComponent("a-input"),u=resolveComponent("a-form-item"),f=resolveComponent("a-tag"),m=resolveComponent("a-form");return openBlock(),createBlock(m,{class:"confbar",layout:"inline",model:t.conf},{default:withCtx(()=>[createVNode(u,{label:"idName"},{default:withCtx(()=>[createVNode(i,{value:t.conf.idName,"onUpdate:value":c[0]||(c[0]=s=>t.conf.idName=s)},null,8,["value"])]),_:1}),createVNode(u,{label:"unitName"},{default:withCtx(()=>[createVNode(i,{value:t.conf.unitName,"onUpdate:value":c[1]||(c[1]=s=>t.conf.unitName=s)},null,8,["value"])]),_:1}),createVNode(u,{label:"srcName"},{default:withCtx(()=>[createVNode(i,{value:t.conf.srcName,"onUpdate:value":c[2]||(c[2]=s=>t.conf.srcName=s)},null,8,["value"])]),_:1}),createVNode(u,{label:"tgtName"},{default:withCtx(()=>[createVNode(i,{value:t.conf.tgtName,"onUpdate:value":c[3]||(c[3]=s=>t.conf.tgtName=s)},null,8,["value"])]),_:1}),createVNode(u,{label:"ignorePatterns"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(t.ignPats,s=>(openBlock(),createBlock(f,{key:s,closable:"",onClose:v=>l(s)},{default:withCtx(()=>[createTextVNode(toDisplayString(s),1)]),_:2},1032,["onClose"]))),128)),n.value.input?(openBlock(),createBlock(i,{key:0,ref_key:"inputRef",ref:o,value:n.value.val,"onUpdate:value":c[4]||(c[4]=s=>n.value.val=s),type:"text",size:"small",style:{width:"100px"},onBlur:r,onKeyup:withKeys(r,["enter"])},null,8,["value","onKeyup"])):(openBlock(),createBlock(f,{key:1,style:{background:"#fff","border-style":"dashed"},onClick:_},{default:withCtx(()=>[_hoisted_1$1]),_:1}))]),_:1})]),_:1},8,["model"])}}};var configVue=_export_sfc(_sfc_main$3,[["__scopeId","data-v-4fef6e48"]]),table_vue_vue_type_style_index_0_scoped_true_lang="";const _sfc_main$2={props:{data:{type:Array,required:!0}},setup(t){const e=[{title:"ID",dataIndex:"id"},{title:"Source",dataIndex:"srcText"},{title:"Target",dataIndex:"tgtText"},{title:"New",dataIndex:"newtgt"}];return(a,n)=>{const o=resolveComponent("a-table");return t.data.length?(openBlock(),createBlock(o,{key:0,dataSource:t.data,columns:e,rowKey:(l,r)=>r,class:"ant-table-striped","row-class-name":(l,r)=>r%2===1?"table-striped":null},null,8,["dataSource","rowKey","row-class-name"])):createCommentVNode("v-if",!0)}}};var tableVue=_export_sfc(_sfc_main$2,[["__scopeId","data-v-657d4b24"]]);function xml2obj(t,e){const a=[];var n=t.querySelectorAll(e.unitName);for(const o of n){const l=o.querySelector(e.srcName),r=o.querySelector(e.tgtName);a.push({id:o[e.idName],unit:o,source:l,target:r,srcText:l.innerHTML,tgtText:r.innerHTML})}return a}function blob2obj(t,e,a="UTF-8"){let n=new FileReader;n.readAsText(t,a),n.onload=e}function str2file(t,e){var a=document.createElement("a");a.setAttribute("download",e),a.style.display="none";var n=new Blob([t]);a.href=URL.createObjectURL(n),document.body.appendChild(a),a.click(),document.body.removeChild(a)}function basename(t,e){const a=t.split("/").reverse()[0];return a.slice(0,a.length-(e==null?void 0:e.length))}function extname(t){const e=t.lastIndexOf(".");return t.slice(e)}var xmlparser_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId=t=>(pushScopeId("data-v-7048e968"),t=t(),popScopeId(),t),_hoisted_1={class:"example"},_hoisted_2=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_3=_withScopeId(()=>createBaseVNode("label",null,"XLIFF/XML ",-1)),_hoisted_4=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_5=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_6=_withScopeId(()=>createBaseVNode("label",null,"JSON ",-1)),_hoisted_7=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_sfc_main$1={setup(__props){const action=ref({searchVal:"",postFunc:'(s)=>s.replace(/id\\s*=\\s*\\"\\s*(\\d+)\\s*"/g, "id=\\"$1\\"")'}),conf=ref({idName:"id",unitName:"trans-unit",srcName:"source",tgtName:"target"}),ignPats=ref(["SWITCH.*#"]),info={suffix:"-res"},map=ref([]),filterData=computed(()=>map.value.filter(t=>!action.value.searchVal||t.tgtText.indexOf(action.value.searchVal)!==-1||t.srcText.indexOf(action.value.searchVal)!==-1));function isIgnore(t){for(const e of ignPats.value)if(new RegExp(e).test(t))return!0;return!1}function jsonProc(jsonText){var t;var obj=JSON.parse(jsonText);let postFunc=action.value.postFunc?eval(action.value.postFunc):e=>e;for(const e of map.value)try{obj[e.id]&&(obj[e.id]=postFunc(obj[e.id])),isIgnore(e.srcText)?e.target.innerHTML=e.srcText:e.target.innerHTML=(t=obj[e.id])!=null?t:e.tgtText,e.newtgt=e.target.innerHTML,e.target.getAttribute("state")==="needs-translation"&&e.target.setAttribute("state","translated"),e.unit.getAttribute("m:confirmed")==="0"&&e.unit.setAttribute("m:confirmed","1")}catch(a){console.log(a,e,isIgnore(e.srcText),obj[e.id])}}const upload_xliff=t=>{info.src=t.target.files[0].name,blob2obj(t.target.files[0],e=>map.value=xml2obj(info.xmlDoc=new DOMParser().parseFromString(e.target.result,"text/xml"),conf.value))},upload_target=t=>blob2obj(t.target.files[0],e=>jsonProc(e.target.result)),extract=()=>{const t={};for(const e of map.value)t[e.id]=e.srcText;str2file(JSON.stringify(t),"sources.json")},save=()=>str2file(new XMLSerializer().serializeToString(info.xmlDoc),basename(info.src,extname(info.src))+info.suffix+extname(info.src));function do_test(){console.log("info ",info),console.log("ignPats ",ignPats.value);let postFunc=action.value.postFunc?eval(action.value.postFunc):t=>t;console.log(typeof postFunc,postFunc,postFunc('test: id = " 3" abc'))}return(t,e)=>{const a=resolveComponent("a-col"),n=resolveComponent("a-row");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(actionVue,{action:action.value,"onUpdate:action":e[0]||(e[0]=o=>action.value=o)},null,8,["action"]),createVNode(configVue,{conf:conf.value,"onUpdate:conf":e[1]||(e[1]=o=>conf.value=o),ignPats:ignPats.value,"onUpdate:ignPats":e[2]||(e[2]=o=>ignPats.value=o)},null,8,["conf","ignPats"]),_hoisted_2,createVNode(n,null,{default:withCtx(()=>[createVNode(a,{span:8},{default:withCtx(()=>[_hoisted_3,createBaseVNode("input",{type:"file",onChange:upload_xliff,accept:".xliff, .mxliff, text/xml"},null,32)]),_:1}),createVNode(a,{span:8},{default:withCtx(()=>[createVNode(n,{class:"btnrow"},{default:withCtx(()=>[createBaseVNode("button",{onClick:extract},"Extract Souces")]),_:1}),_hoisted_4,createVNode(n,{class:"btnrow"},{default:withCtx(()=>[createBaseVNode("button",{onClick:save},"Save")]),_:1}),_hoisted_5,createVNode(n,{class:"btnrow"},{default:withCtx(()=>[createBaseVNode("button",{onClick:do_test},"Test")]),_:1})]),_:1}),createVNode(a,{span:8},{default:withCtx(()=>[_hoisted_6,createBaseVNode("input",{type:"file",onChange:upload_target,accept:".json, application/JSON"},null,32)]),_:1})]),_:1}),_hoisted_7,createVNode(tableVue,{data:unref(filterData),"onUpdate:data":e[3]||(e[3]=o=>isRef(filterData)?filterData.value=o:null)},null,8,["data"])])}}};var xmlparserVue=_export_sfc(_sfc_main$1,[["__scopeId","data-v-7048e968"]]),App_vue_vue_type_style_index_0_lang="";const _sfc_main={setup(t){return(e,a)=>(openBlock(),createBlock(xmlparserVue))}};var antd="";const app=createApp(_sfc_main);app.use(Antd).mount("#app");
