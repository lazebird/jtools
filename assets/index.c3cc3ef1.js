import{r as resolveComponent,o as openBlock,c as createBlock,w as withCtx,a as createVNode,p as pushScopeId,b as popScopeId,d as createBaseVNode,e as ref,f as createElementBlock,g as renderList,F as Fragment,h as withKeys,i as createTextVNode,n as nextTick,t as toDisplayString,j as createCommentVNode,k as computed,u as unref,l as isRef,m as createApp,A as Antd}from"./vendor.64da502d.js";const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}};p();var action_vue_vue_type_style_index_0_scoped_true_lang="",_export_sfc=(e,t)=>{const o=e.__vccOpts||e;for(const[n,a]of t)o[n]=a;return o};const _withScopeId$1=e=>(pushScopeId("data-v-14d9a9d0"),e=e(),popScopeId(),e),_hoisted_1$2=_withScopeId$1(()=>createBaseVNode("a",{href:"https://github.com/lazebird/xliff-helper",target:"_blank"},"@lazebird/xliff-helper",-1)),_sfc_main$4={props:{action:{type:Object,required:!0}},setup(e){return(t,o)=>{const n=resolveComponent("a-form-item"),a=resolveComponent("a-input"),l=resolveComponent("a-form");return openBlock(),createBlock(l,{class:"actionbar",layout:"inline",model:e.action},{default:withCtx(()=>[createVNode(n,{label:"Home"},{default:withCtx(()=>[_hoisted_1$2]),_:1}),createVNode(n,{label:"PostFunc"},{default:withCtx(()=>[createVNode(a,{value:e.action.postFunc,"onUpdate:value":o[0]||(o[0]=r=>e.action.postFunc=r),"allow-clear":""},null,8,["value"])]),_:1}),createVNode(n,{label:"Filter"},{default:withCtx(()=>[createVNode(a,{value:e.action.searchVal,"onUpdate:value":o[1]||(o[1]=r=>e.action.searchVal=r),"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"])}}};var actionVue=_export_sfc(_sfc_main$4,[["__scopeId","data-v-14d9a9d0"]]),config_vue_vue_type_style_index_0_scoped_true_lang="";const _hoisted_1$1=createTextVNode(" + New Tag "),_sfc_main$3={props:{conf:{type:Object,required:!0},ignPats:{type:Array,required:!0}},emits:["update:ignPats"],setup(e,{emit:t}){const o=e,n=ref({input:!1,val:""}),a=ref();function l(d){ignPats.value=ignPats.value.filter(c=>c!==d)}function r(){n.value.val&&o.ignPats.indexOf(n.value.val)===-1&&t("update:ignPats",[...o.ignPats,n.value.val]),n.value={input:!1,val:""}}function _(){n.value.input=!0,nextTick(()=>a.value.focus())}return(d,c)=>{const i=resolveComponent("a-input"),u=resolveComponent("a-form-item"),f=resolveComponent("a-tag"),m=resolveComponent("a-form");return openBlock(),createBlock(m,{class:"confbar",layout:"inline",model:e.conf},{default:withCtx(()=>[createVNode(u,{label:"idName"},{default:withCtx(()=>[createVNode(i,{value:e.conf.idName,"onUpdate:value":c[0]||(c[0]=s=>e.conf.idName=s)},null,8,["value"])]),_:1}),createVNode(u,{label:"unitName"},{default:withCtx(()=>[createVNode(i,{value:e.conf.unitName,"onUpdate:value":c[1]||(c[1]=s=>e.conf.unitName=s)},null,8,["value"])]),_:1}),createVNode(u,{label:"srcName"},{default:withCtx(()=>[createVNode(i,{value:e.conf.srcName,"onUpdate:value":c[2]||(c[2]=s=>e.conf.srcName=s)},null,8,["value"])]),_:1}),createVNode(u,{label:"tgtName"},{default:withCtx(()=>[createVNode(i,{value:e.conf.tgtName,"onUpdate:value":c[3]||(c[3]=s=>e.conf.tgtName=s)},null,8,["value"])]),_:1}),createVNode(u,{label:"ignorePatterns"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.ignPats,s=>(openBlock(),createBlock(f,{key:s,closable:"",onClose:v=>l(s)},{default:withCtx(()=>[createTextVNode(toDisplayString(s),1)]),_:2},1032,["onClose"]))),128)),n.value.input?(openBlock(),createBlock(i,{key:0,ref_key:"inputRef",ref:a,value:n.value.val,"onUpdate:value":c[4]||(c[4]=s=>n.value.val=s),type:"text",size:"small",style:{width:"100px"},onBlur:r,onKeyup:withKeys(r,["enter"])},null,8,["value","onKeyup"])):(openBlock(),createBlock(f,{key:1,style:{background:"#fff","border-style":"dashed"},onClick:_},{default:withCtx(()=>[_hoisted_1$1]),_:1}))]),_:1})]),_:1},8,["model"])}}};var configVue=_export_sfc(_sfc_main$3,[["__scopeId","data-v-4fef6e48"]]),table_vue_vue_type_style_index_0_scoped_true_lang="";const _sfc_main$2={props:{data:{type:Array,required:!0}},setup(e){const t=[{title:"ID",dataIndex:"id"},{title:"Source",dataIndex:"srcText"},{title:"Target",dataIndex:"tgtText"},{title:"New",dataIndex:"newtgt"}];return(o,n)=>{const a=resolveComponent("a-table");return e.data.length?(openBlock(),createBlock(a,{key:0,dataSource:e.data,columns:t,rowKey:(l,r)=>r,class:"ant-table-striped","row-class-name":(l,r)=>r%2===1?"table-striped":null},null,8,["dataSource","rowKey","row-class-name"])):createCommentVNode("v-if",!0)}}};var tableVue=_export_sfc(_sfc_main$2,[["__scopeId","data-v-657d4b24"]]);function xml2obj(e,t){const o=[];var n=e.querySelectorAll(t.unitName);for(const a of n){const l=a.querySelector(t.srcName),r=a.querySelector(t.tgtName);o.push({id:a[t.idName],source:l,target:r,srcText:l.innerHTML,tgtText:r.innerHTML})}return o}function blob2obj(e,t,o="UTF-8"){let n=new FileReader;n.readAsText(e,o),n.onload=t}function str2file(e,t){var o=document.createElement("a");o.setAttribute("download",t),o.style.display="none";var n=new Blob([e]);o.href=URL.createObjectURL(n),document.body.appendChild(o),o.click(),document.body.removeChild(o)}var xmlparser_vue_vue_type_style_index_0_scoped_true_lang="";const _withScopeId=e=>(pushScopeId("data-v-7048e968"),e=e(),popScopeId(),e),_hoisted_1={class:"example"},_hoisted_2=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_3=_withScopeId(()=>createBaseVNode("label",null,"XLIFF/XML ",-1)),_hoisted_4=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_5=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_hoisted_6=_withScopeId(()=>createBaseVNode("label",null,"JSON ",-1)),_hoisted_7=_withScopeId(()=>createBaseVNode("br",null,null,-1)),_sfc_main$1={setup(__props){var xmlDoc;const action=ref({searchVal:"",postFunc:'(s)=>s.replace(/id\\s*=\\s*\\"\\s*(\\d+)\\s*"/g, "id=\\"$1\\"")'}),conf=ref({idName:"id",unitName:"trans-unit",srcName:"source",tgtName:"target"}),ignPats=ref(["SWITCH.*#"]),map=ref([]),filterData=computed(()=>map.value.filter(e=>!action.value.searchVal||e.tgtText.indexOf(action.value.searchVal)!==-1||e.srcText.indexOf(action.value.searchVal)!==-1));function isIgnore(e){for(const t of ignPats.value)if(new RegExp(t).test(e))return!0;return!1}function jsonProc(jsonText){var e;var obj=JSON.parse(jsonText);let postFunc=action.value.postFunc?eval(action.value.postFunc):t=>t;for(const t of map.value)try{obj[t.id]&&(obj[t.id]=postFunc(obj[t.id])),isIgnore(t.srcText)?t.target.innerHTML=t.srcText:t.target.innerHTML=(e=obj[t.id])!=null?e:t.tgtText,t.newtgt=t.target.innerHTML,t.target.getAttribute("state")==="needs-translation"&&t.target.setAttribute("state","translated")}catch(o){console.log(o,t,isIgnore(t.srcText),obj[t.id])}}const upload_xliff=e=>blob2obj(e.target.files[0],t=>map.value=xml2obj(xmlDoc=new DOMParser().parseFromString(t.target.result,"text/xml"),conf.value)),upload_target=e=>blob2obj(e.target.files[0],t=>jsonProc(t.target.result)),extract=()=>{const e={};for(const t of map.value)e[t.id]=t.srcText;str2file(JSON.stringify(e),"sources.json")},save=()=>str2file(new XMLSerializer().serializeToString(xmlDoc),"result.xliff");function do_test(){console.log("xmlDoc ",xmlDoc),console.log("ignPats ",ignPats.value);let postFunc=action.value.postFunc?eval(action.value.postFunc):e=>e;console.log(typeof postFunc,postFunc,postFunc('test: id = " 3" abc'))}return(e,t)=>{const o=resolveComponent("a-col"),n=resolveComponent("a-row");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(actionVue,{action:action.value,"onUpdate:action":t[0]||(t[0]=a=>action.value=a)},null,8,["action"]),createVNode(configVue,{conf:conf.value,"onUpdate:conf":t[1]||(t[1]=a=>conf.value=a),ignPats:ignPats.value,"onUpdate:ignPats":t[2]||(t[2]=a=>ignPats.value=a)},null,8,["conf","ignPats"]),_hoisted_2,createVNode(n,null,{default:withCtx(()=>[createVNode(o,{span:8},{default:withCtx(()=>[_hoisted_3,createBaseVNode("input",{type:"file",onChange:upload_xliff,accept:".xliff, text/xml"},null,32)]),_:1}),createVNode(o,{span:8},{default:withCtx(()=>[createVNode(n,{class:"btnrow"},{default:withCtx(()=>[createBaseVNode("button",{onClick:extract},"Extract Souces")]),_:1}),_hoisted_4,createVNode(n,{class:"btnrow"},{default:withCtx(()=>[createBaseVNode("button",{onClick:save},"Save")]),_:1}),_hoisted_5,createVNode(n,{class:"btnrow"},{default:withCtx(()=>[createBaseVNode("button",{onClick:do_test},"Test")]),_:1})]),_:1}),createVNode(o,{span:8},{default:withCtx(()=>[_hoisted_6,createBaseVNode("input",{type:"file",onChange:upload_target,accept:".json, application/JSON"},null,32)]),_:1})]),_:1}),_hoisted_7,createVNode(tableVue,{data:unref(filterData),"onUpdate:data":t[3]||(t[3]=a=>isRef(filterData)?filterData.value=a:null)},null,8,["data"])])}}};var xmlparserVue=_export_sfc(_sfc_main$1,[["__scopeId","data-v-7048e968"]]),App_vue_vue_type_style_index_0_lang="";const _sfc_main={setup(e){return(t,o)=>(openBlock(),createBlock(xmlparserVue))}};var antd="";const app=createApp(_sfc_main);app.use(Antd).mount("#app");
